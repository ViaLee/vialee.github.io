(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{348:function(t,s,a){t.exports=a.p+"assets/img/tserror.df307612.jpg"},349:function(t,s,a){t.exports=a.p+"assets/img/recoil.ee5d1e8b.jpg"},373:function(t,s,a){"use strict";a.r(s);var n=a(17),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"日常问题记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日常问题记录"}},[t._v("#")]),t._v(" 日常问题记录")]),t._v(" "),s("h3",{attrs:{id:"组件库发布-t-环境构建失败"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件库发布-t-环境构建失败"}},[t._v("#")]),t._v(" 组件库发布 t 环境构建失败")]),t._v(" "),s("p",[t._v("组件库项目这个版本使用 lerna 进行了分包，并将 father 版本从 1^ 升至了 4^"),s("br"),t._v("\n发布时如下报错：")]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("+ npm run build:test\n\n> root@1.0.111 build:test\n> cross-env CROSS_ENV='t-' npm run build:cdn && npm run docs:build && npm run copyUmd\n\nnpm WARN logfile Error: EACCES: permission denied, scandir '/root/.npm/_logs'\nnpm WARN logfile error cleaning log files [Error: EACCES: permission denied, scandir '/root/.npm/_logs'] {\nnpm WARN logfile errno: -13,\nnpm WARN logfile code: 'EACCES',\nnpm WARN logfile syscall: 'scandir',\nnpm WARN logfile path: '/root/.npm/_logs'\nnpm WARN logfile }\n\n> root@1.0.111 build:cdn\n> lerna run build\n\nlerna notice cli v4.0.0\nlerna info versioning independent\nlerna info ci enabled\nlerna info Executing command in 2 packages: \"npm run build\"\nlerna ERR! npm run build exited 1 in '@myun/common-component'\nlerna ERR! npm run build stdout:\n\n> @myun/common-component@0.0.13 build\n> father build\n\nlerna ERR! npm run build stderr:\nnpm WARN logfile Error: EACCES: permission denied, scandir '/root/.npm/_logs'\nnpm WARN logfile error cleaning log files [Error: EACCES: permission denied, scandir '/root/.npm/_logs'] {\nnpm WARN logfile errno: -13,\nnpm WARN logfile code: 'EACCES',\nnpm WARN logfile syscall: 'scandir',\nnpm WARN logfile path: '/root/.npm/_logs'\nnpm WARN logfile }\nnode:internal/fs/utils:347\n throw err;\n ^\n\nError: EACCES: permission denied, mkdir '/home/jenkins/workspace/ask-sharelib-test/packages/common-component/node_modules/.cache/logger'\n at Object.mkdirSync (node:fs:1382:3)\n at Object.e.exports.makeDirSync (/home/jenkins/workspace/ask-sharelib-test/packages/common-component/node_modules/@umijs/utils/compiled/fs-extra/index.js:1:15306)\n at Object.<anonymous> (/home/jenkins/workspace/ask-sharelib-test/packages/common-component/node_modules/@umijs/utils/dist/logger.js:69:27)\n at Module._compile (/home/jenkins/workspace/ask-sharelib-test/node_modules/v8-compile-cache/v8-compile-cache.js:192:30)\n at Object.Module._extensions..js (node:internal/modules/cjs/loader:1250:10)\n at Module.load (node:internal/modules/cjs/loader:1074:32)\n at Function.Module._load (node:internal/modules/cjs/loader:909:12)\n at Module.require (node:internal/modules/cjs/loader:1098:19)\n at require (/home/jenkins/workspace/ask-sharelib-test/node_modules/v8-compile-cache/v8-compile-cache.js:159:20)\n at Object.<anonymous> (/home/jenkins/workspace/ask-sharelib-test/packages/common-component/node_modules/@umijs/utils/dist/index.js:109:22) {\n errno: -13,\n syscall: 'mkdir',\n code: 'EACCES',\n path: '/home/jenkins/workspace/ask-sharelib-test/packages/common-component/node_modules/.cache/logger'\n}\nnpm ERR! Lifecycle script `build` failed with error:\nnpm ERR! Error: command failed\nnpm ERR! in workspace: @myun/common-component@0.0.13\nnpm ERR! at location: /home/jenkins/workspace/ask-sharelib-test/packages/common-component\nlerna ERR! npm run build exited 1 in '@myun/common-component'\nlerna WARN complete Waiting for 1 child process to exit. CTRL-C to exit immediately.\n\n")])])]),s("p",[t._v("node_modules/.cache/logger 写入没有权限")]),t._v(" "),s("ul",[s("li",[t._v("首先考虑提升角色权限")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --unsafe-perm --allow-root\n")])])]),s("ul",[s("li",[t._v("father build 为啥要往 node_modules/.cache 文件中写入 logger 文件"),s("br"),t._v("\n默认会在构建过程中将缓存文件放在该文件下，比如 logger 文件、webpack 缓存、mfsu 缓存等。")]),t._v(" "),s("li",[t._v("考虑阻止写入 logger 文件，也就是跳过日志\n在.fatherrc.ts 中配置以下,参考 webpack 配置："),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("logger")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("level")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'silent'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),t._v("但是报错，logger 配置没有开放出来")]),t._v(" "),s("li",[t._v("还是考虑解决权限问题，最终由运维解决了")])]),t._v(" "),s("h3",{attrs:{id:"lerna-yarn-迁移为-pnpm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-yarn-迁移为-pnpm"}},[t._v("#")]),t._v(" lerna yarn 迁移为 pnpm")]),t._v(" "),s("p",[t._v("创建 pnpm-workspace.yaml 文件")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("prefer-workspace-packages: true\npackages:\n  - 'packages/*'\n\n")])])]),s("p",[t._v("创建.npmrc 文件,允许幽灵依赖访问其他依赖")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("shamefully-hoist=true\n")])])]),s("p",[t._v("执行 pnpm i，根目录生成一个 pnpm-lock.yaml 文件，其中有根目录及所有包的依赖树")]),t._v(" "),s("h3",{attrs:{id:"yarn-迁移为-pnpm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yarn-迁移为-pnpm"}},[t._v("#")]),t._v(" yarn 迁移为 pnpm")]),t._v(" "),s("p",[t._v("使用 pnpm import pnpm-lock.yaml ，根据 yarn.lock 生成 pnpm-lock.yaml")]),t._v(" "),s("p",[t._v("出现以下问题：")]),t._v(" "),s("p",[t._v("1.webpack 版本冲突")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("\nThere might be a problem with the project dependency tree.\nIt is likely not a bug "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Create React App, but something you need to fix locally.\n\nThe react-scripts package provided by Create React App requires a dependency:\n\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4.44.2"')]),t._v("\n\nDon't try to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" it manually: your package manager does it automatically.\nHowever, a different version of webpack was detected higher up "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the tree:\n\n  /Users/vialee/gaodun/learn-platform.gaodun.com/node_modules/webpack "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("version: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.89")]),t._v(".0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nManually installing incompatible versions is known to cause hard-to-debug issues.\n\nIf you would prefer to ignore this check, "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SKIP_PREFLIGHT_CHECK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true to an .env "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" your project.\nThat will permanently disable this message but you might encounter other issues.\n\nTo fix the dependency tree, try following the steps below "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the exact order:\n\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(". Delete package-lock.json "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("not package.json"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" and/or yarn.lock "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" your project folder.\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(". Delete node_modules "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" your project folder.\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(". Remove "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack"')]),t._v(" from dependencies and/or devDependencies "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the package.json "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" your project folder.\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(". Run "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" or yarn, depending on the package manager you use.\n\nIn "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("most")]),t._v(" cases, this should be enough to fix the problem.\nIf this has not helped, there are a few other things you can try:\n\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(". If you used npm, "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http://yarnpkg.com/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" and repeat the above steps with it instead.\n     This may "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v(" because "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" has known issues with package hoisting "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" may get resolved "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" future versions.\n\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(". Check "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" /Users/vialee/gaodun/learn-platform.gaodun.com/node_modules/webpack is outside your project directory.\n     For example, you might have accidentally installed something "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" your home folder.\n\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(". Try running "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" webpack "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" your project folder.\n     This will tell you "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" other package "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("apart from the expected react-scripts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" installed webpack.\n\nIf nothing "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" helps, "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SKIP_PREFLIGHT_CHECK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true to an .env "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" your project.\nThat would permanently disable this preflight check "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" you want to proceed anyway.\n\nP.S. We know this message is long but please "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v(" the steps above :-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" We hope you "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" them helpful"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])]),s("p",[t._v("分析： 一些依赖项对于 webpack 的版本以来不一致\n解决：统一 webpack 版本，升级 react-script (3->5)")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@craco/craco"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"7.1.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"react-scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("node 20 使用 pnpm 7.30.5 出现以下 error，不管什么源。")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" WARN  GET http://npm-service.gaodunwangxiao.com/create-react-app error (ERR_INVALID_THIS). Will retry in 1 minute. 1 retries left.\n")])])]),s("p",[t._v("解决：降低 node 版本(16)或者升级 pnpm(8)")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("项目使用了 craco-fast-refresh ，官方建议使用 craV4 版本，但是项目之前使用的 V3，目前升级后是 V5 版本，所以会报错：")]),t._v(" "),s("ul",[s("li",[t._v("引用了 src 以外的资源")]),t._v(" "),s("li",[t._v("写法正确但报 'cannot read properties of undefined(reading module) webpack complied error'")])])])]),t._v(" "),s("p",[t._v("解决： 弃用这个插件，使用 cra 自带热更")]),t._v(" "),s("p",[t._v('4.eslint react 冲突 ‘ERROR in Plugin "react" was conflicted between ".eslintrc.json" and "BaseConfig"’')]),t._v(" "),s("p",[t._v("每次修改，热更后都报错，重新保存 package.json 就不报了")]),t._v(" "),s("p",[t._v("解决：禁用 cra 自带的 eslint 启动项添加 DISABLE_ESLINT_PLUGIN=true 属性")]),t._v(" "),s("h3",{attrs:{id:"网页打印样式、调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网页打印样式、调试"}},[t._v("#")]),t._v(" 网页打印样式、调试")]),t._v(" "),s("p",[t._v("css 分页： break-after\n调试打印样式：\ndevtool command+shift+p rendering\n选择 emulate css media type print")]),t._v(" "),s("h3",{attrs:{id:"组件库发版-缓存问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件库发版-缓存问题"}},[t._v("#")]),t._v(" 组件库发版 缓存问题")]),t._v(" "),s("p",[t._v("背景：业务组件库打包成 umd 并放在 oss 服务器上存储，工作台项目通过 cdn 获取该打包结果，并用其提供的业务组件配置页面保存后发布该页面，在用户端即可访问配置的页面。"),s("br"),t._v("\n问题：get 请求缓存。组件库发版后，用户访问的页面组件并没有更新。"),s("br"),t._v("\n解决：因此目前解决方案是在配置页面时请求 umd 地址后加一个版本号，每次都得手动修改，从而使用户端发送最新版本的请求。"),s("br"),t._v("\n问题：cdn 缓存。cdn 接收到客户端发送来的请求，如果该版本本地已经存在，则直接返回，如果不存在，则请求存储服务器获取最新的资源。 除此之外 cdn 也会定期拉取。")]),t._v(" "),s("h3",{attrs:{id:"给高度-auto-的-dom-动画过渡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#给高度-auto-的-dom-动画过渡"}},[t._v("#")]),t._v(" 给高度 auto 的 dom 动画过渡")]),t._v(" "),s("p",[t._v("好奇 ant-collapse 的展开收起动画效果怎么做的，内容自适应")]),t._v(" "),s("div",{staticClass:"language-css extra-class"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("max-height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("transition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".wrap :hover div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("max-height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 800px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*大概的值，需要超过元素高度*/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"浏览器非激活状态-setinterval、settimeout-会停止运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器非激活状态-setinterval、settimeout-会停止运行"}},[t._v("#")]),t._v(" 浏览器非激活状态 setInterval、setTimeout 会停止运行")]),t._v(" "),s("p",[t._v("浏览器优化策略，非激活状态的")]),t._v(" "),s("p",[t._v("1.使用 worker 计算")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initCountWorker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" self "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" worker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Worker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/public/src/js/utils/count-worker.js")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("countWorker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timeCount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" countdown "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCountdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hour"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" minute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" second "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" countdown"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.tiku-detail-time'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("倒计时：")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("hour"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" : ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("minute"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" : ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("second"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isUpload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("msg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'文件正在上传，请稍后提交'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n                    _this"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("submitExam")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// worker.js")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"count-worker 启动"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" self "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" initTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"初始剩余时间"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" initTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("initTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("window.onFocus 切回来重新调接口获取最新时间\nwindow.onFocus 小屏切换也会触发，只要页面被聚焦")])]),t._v(" "),s("h3",{attrs:{id:"源码-map-文件请求混杂报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#源码-map-文件请求混杂报错"}},[t._v("#")]),t._v(" 源码 map 文件请求混杂报错")]),t._v(" "),s("p",[t._v("和打包开启源文件有关")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("url = /web/exam/answer_sheet/runtime-header.83184b99.js.map\n")])])]),s("h3",{attrs:{id:"css-梯形"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#css-梯形"}},[t._v("#")]),t._v(" css 梯形")]),t._v(" "),s("div",{staticClass:"language-css extra-class"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".trapezoid")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 200px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("background-color")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" #f00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("clip-path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("polygon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 100% 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 80% 100%"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 20% 100%"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("clip-path polygon 的值是左上角顺时针四个角，横纵坐标的值，收尾点的位置需要重合，中间围起来的区域就是最终图形。有个缺点：这样的图形背景色是取反的，因为是 clip。")]),t._v(" "),s("h3",{attrs:{id:"根据图片主色调设置-dom-背景色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#根据图片主色调设置-dom-背景色"}},[t._v("#")]),t._v(" 根据图片主色调设置 dom 背景色")]),t._v(" "),s("p",[t._v("UI 说 文字背景色要根据上方图片主色调自动设置"),s("br"),t._v("\n查阅了一圈发现两个办法：")]),t._v(" "),s("ul",[s("li",[t._v("JS\n将图片放入 canvas 面板中，使用 canvas cxt 的 getImageData()获取图片色码值，是个很长的数组\n然后遍历数组，对色码进行统计，拿到最多次数的色码值")]),t._v(" "),s("li",[t._v("CSS\n使用高斯模糊&放大"),s("div",{staticClass:"language-css extra-class"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("background-image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token url"}},[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string url"}},[t._v('"图片"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("transform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scale")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("60"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("blur")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("50px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),t._v("两种都有缺点：\n"),s("ol",[s("li",[t._v("需要处理数据多的情况 JS 遍历的数组多且长，消耗性能，也有优化将图片缩小后拿缩略图统计，但个人还是不喜欢 JS 处理")]),t._v(" "),s("li",[t._v("将 dom 放大 60 倍也可能有些问题，且实际效果没有 JS 统计精准，但目前使用的是该方法")])])])]),t._v(" "),s("h3",{attrs:{id:"服务器被挖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器被挖"}},[t._v("#")]),t._v(" 服务器被挖")]),t._v(" "),s("p",[t._v("同事发现他的腾讯云服务器运行超级慢，啥也没干 CPU 占满了，然后使用")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-aux")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#所有用户所有进程")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" root    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#root用户进程")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" root   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#root用户进程")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-9")]),t._v(" PID   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#终止进程")]),t._v("\n")])])]),s("p",[t._v("查看进程情况，发现有一个占用了 130%CPU，来自 /tmp/kdevtmpfsi"),s("br"),t._v("\n问 ChatGPT，发现是个恶意的挖矿程序，给出了以下阻止方法：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-iname")]),t._v(" kdevtmpfsi* "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-fv")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除所有kdevtmpfsi相关程序")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-iname")]),t._v(" kinsing* "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-fv")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除所有kdevtmpfsi相关程序")]),t._v("\n")])])]),s("p",[t._v("根据删除的文件地址发现是在 docker 镜像里，可能是 docker 镜像没有做安全设置。"),s("br"),t._v("\n决定写一个脚本监控如果发现 kdevtmpfsi 程序就执行终止。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" kdevtmpfsi* "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $1,$NF}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#列出所有运行中的容器 | 按名称过滤 | 打印ID 和 名称 并赋给a")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#输出a")]),t._v("\n")])])]),s("p",[t._v("根据 docker 镜像管理工具显示，是镜像运行过程中执行了一段脚本，且采用的静默模式。")]),t._v(" "),s("h3",{attrs:{id:"本地资源模拟测试环境资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地资源模拟测试环境资源"}},[t._v("#")]),t._v(" 本地资源模拟测试环境资源")]),t._v(" "),s("ol",[s("li",[t._v("将本地服务转 https，端口使用 443 默认端口，避免端口不一致导致的跨域问题.")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("local-ssl-proxy "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--source")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--target")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("还报跨域")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("http-server "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cors")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将服务启用为允许所有源")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("还报错 net::ERR_CERT_AUTHORITY_INVALID"),s("br"),t._v("\n原因是：浏览器无法验证代理的 https 的 SSL"),s("br"),t._v("\n直接访问该地址，提示安全，点击继续访问后，不报错了。")]),t._v(" "),s("li",[t._v("访问默认端口，Request failed to proxy: ECONNREFUSED，原因也是 3")])]),t._v(" "),s("h3",{attrs:{id:"组件库发布-t-环境构建失败-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件库发布-t-环境构建失败-2"}},[t._v("#")]),t._v(" 组件库发布 t 环境构建失败")]),t._v(" "),s("p",[t._v("从 gitlab 构建日志分析得出，是写入日志时没有权限。"),s("RouterLink",{attrs:{to:"/pages/blog.html"}},[t._v("详情")])],1),t._v(" "),s("h3",{attrs:{id:"离开页面埋点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#离开页面埋点"}},[t._v("#")]),t._v(" 离开页面埋点")]),t._v(" "),s("p",[t._v("写在 beforeUnload 回调里，取消默认事件离开页面会提示用户是否确认离开")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beforeunload"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cancel the event as stated by the standard.")]),t._v("\n  event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("preventDefault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Chrome requires returnValue to be set.")]),t._v("\n  event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("returnValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"协助-app-解决问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#协助-app-解决问题"}},[t._v("#")]),t._v(" 协助 App 解决问题")]),t._v(" "),s("h4",{attrs:{id:"内嵌-h5-页面获取-app-的-token-首次未获取到"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内嵌-h5-页面获取-app-的-token-首次未获取到"}},[t._v("#")]),t._v(" 内嵌 H5 页面获取 app 的 token，首次未获取到")]),t._v(" "),s("p",[t._v("安卓环境，清除缓存后重新登录 App，进入 h5 页面，未获取到 token，第二次进入 h5 页面正常。")]),t._v(" "),s("ul",[s("li",[t._v("h5 页面 PC、H5、App 共用，需要区分当前环境")]),t._v(" "),s("li",[t._v("token 有三种情况、H5 自身登录、PC 跳转 URL 带入、App 登录获取")]),t._v(" "),s("li",[t._v("区分是否首次从 App 进入，决定是否要获取 App token")])]),t._v(" "),s("h4",{attrs:{id:"app-内退出登录需要跳转到-app-登录页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#app-内退出登录需要跳转到-app-登录页"}},[t._v("#")]),t._v(" app 内退出登录需要跳转到 App 登录页")]),t._v(" "),s("ul",[s("li",[t._v("区分环境")]),t._v(" "),s("li",[t._v("跳转 URL Schema")])]),t._v(" "),s("h3",{attrs:{id:"egg-混合-react-页面项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#egg-混合-react-页面项目"}},[t._v("#")]),t._v(" egg 混合 react 页面项目")]),t._v(" "),s("p",[t._v("老项目采用 egg、jquery 开发、部分页面采用 react 重构、目前方案是将新页面放在一个 react 项目内打包放在老项目里，路由直接读取打包后的产物，问题：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("统一导航栏，新老页面都是用 react 中的导航栏"),s("br"),t._v("\n将导航栏单独打包输出，在老页面读取产物")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//webpack 配置")]),t._v("\nwebpackConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("entry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("header")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/header.tsx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("plugins")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("htmlWebpackPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"header.html"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("chunks")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"header"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./public/header.html"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("需要区分环境读取对应的 build 包，全局变量_system_env 通过中间件统一传入")]),t._v(" "),s("div",{staticClass:"language-ejs extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ejs"}},[s("code",[s("span",{pre:!0,attrs:{class:"token ejs language-ejs"}},[s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%-")]),s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../public/build-'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("_system_env"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/header.html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ")]),s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("-%>")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("antd 全局样式污染问题"),s("br"),t._v("\n没有发现好的解决办法、暂时通过覆盖解决")])])]),t._v(" "),s("h3",{attrs:{id:"error-ts1110-build-type-expected"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#error-ts1110-build-type-expected"}},[t._v("#")]),t._v(" Error TS1110 Build: Type expected")]),t._v(" "),s("p",[s("img",{attrs:{src:a(348),alt:"tserror"}})]),t._v(" "),s("p",[t._v("ts 版本过低,缺少部分类型定义,升级")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('"typescript": "^3.7.5"\n"typescript": "4.2.4",\n')])])]),s("h3",{attrs:{id:"系统升级为-macos-ventura"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统升级为-macos-ventura"}},[t._v("#")]),t._v(" 系统升级为 macOS Ventura")]),t._v(" "),s("p",[t._v("拉 git 项目报错， no matching host key type found."),s("br"),t._v("\n解决："),s("br"),t._v("\n修改~/.ssh/config （没有的话需要新建）文件，添加如下两行配置：")]),t._v(" "),s("p",[s("code",[t._v("HostkeyAlgorithms +ssh-rsa")]),s("br"),t._v(" "),s("code",[t._v("PubkeyAcceptedAlgorithms +ssh-rsa")])]),t._v(" "),s("h3",{attrs:{id:"taro-项目编译-h5-白屏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#taro-项目编译-h5-白屏"}},[t._v("#")]),t._v(" taro 项目编译 h5 白屏")]),t._v(" "),s("ol",[s("li",[t._v("部分安卓手机 UC 浏览器、苹果 safri 浏览器页面白屏；\n本地启动真机访问无异常"),s("br"),t._v("\n本地编译 h5 后使用真机访问白屏")])]),t._v(" "),s("p",[t._v("解决过程："),s("br"),t._v("\n使用 vconsole，CDN 方式引入，看到白屏页面报错："),s("br"),t._v("\n'Uncaught SyntaxError:'super' keyword unexpected here'"),s("br"),t._v("\n是项目中使用的 Recoil 兼容性问题，查看官网发现不支持 ES5，得另外使用 babel 编译。"),s("br"),t._v("\n将 Recoil 以 CDN 方式引入得以解决。暂未找到其他更好的办法。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(349),alt:"Recoil"}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[t._v("使用 Taro.redirectTo,reLaunch 跳转，路由变化但页面白屏\n版本升级")])]),t._v(" "),s("li",[s("p",[t._v("编译报错，sass 中不支持/运算"),s("br"),t._v("\n打补丁，单独处理")])])]),t._v(" "),s("h3",{attrs:{id:"eslint-报错-忽略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eslint-报错-忽略"}},[t._v("#")]),t._v(" eslint 报错 忽略")]),t._v(" "),s("ol",[s("li",[t._v("/_ eslint-disable _/")]),t._v(" "),s("li",[t._v('在.eslintrc.js>rules 添加@typescript-eslint/no-var-requires ，如下：\nrules: {\n"@typescript-eslint/no-var-requires": 0,\n}')])]),t._v(" "),s("h3",{attrs:{id:"下载文件-文件过大-报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载文件-文件过大-报错"}},[t._v("#")]),t._v(" 下载文件 文件过大 报错")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("download")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以二进制文件修改")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blob"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createObjectURL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新建a标签")]),t._v("\n    a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("download "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//下载下来的文件名")]),t._v("\n    a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" event "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MouseEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"click"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatchEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 下载时readyState===3，一次请求一直被调用")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  中途 xhr.abort() xhr.readyState===0 且 xhr.status===0")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("readyState 属性表示 Ajax 请求的当前状态。\n0 代表未初始化。 还没有调用 open 方法\n1 代表正在加载。 open 方法已被调用，但 send 方法还没有被调用\n2 代表已加载完毕。send 已被调用。请求已经开始\n3 代表交互中。服务器正在发送响应\n4 代表完成。响应发送完毕")]),t._v(" "),s("p",[t._v("场景：某些电脑(同一用户)，下载同样的文件，从页面点击下载报错，浏览器贴链接下载正常。\n报错：")]),t._v(" "),s("ol",[s("li",[t._v("Get net::ERR_CONTENT_LENGTH_MISMATCH 200 (OK)\nStatus Code: 200 OK\nnetwork status (failed)net::ERR_CONTENT_LENGTH_MISMATCH")]),t._v(" "),s("li",[t._v("(failed)net::ERR_FAILED 200 (OK) network 中的 sourceSize 为 0"),s("br"),t._v("\n请求异常中断导致没有下载")])]),t._v(" "),s("h3",{attrs:{id:"chrome-点击浏览器回退-页面不刷新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chrome-点击浏览器回退-页面不刷新"}},[t._v("#")]),t._v(" chrome 点击浏览器回退 页面不刷新")]),t._v(" "),s("p",[t._v("chrome 的 back/forward cache 机制")])])}),[],!1,null,null,null);s.default=e.exports}}]);