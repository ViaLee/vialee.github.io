<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP | 💫Viaのblog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/babe.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.795a5f26.css" as="style"><link rel="preload" href="/assets/js/app.1a8c5bfd.js" as="script"><link rel="preload" href="/assets/js/2.dec9ee96.js" as="script"><link rel="preload" href="/assets/js/23.a9bc2c2a.js" as="script"><link rel="prefetch" href="/assets/js/10.8be9e924.js"><link rel="prefetch" href="/assets/js/11.44f5bc5a.js"><link rel="prefetch" href="/assets/js/12.13eb32e8.js"><link rel="prefetch" href="/assets/js/13.0b29cc16.js"><link rel="prefetch" href="/assets/js/14.a078733b.js"><link rel="prefetch" href="/assets/js/15.11a9ccdf.js"><link rel="prefetch" href="/assets/js/16.a2c3d2a9.js"><link rel="prefetch" href="/assets/js/17.980f556f.js"><link rel="prefetch" href="/assets/js/18.cea60c17.js"><link rel="prefetch" href="/assets/js/19.a727f28e.js"><link rel="prefetch" href="/assets/js/20.023d0896.js"><link rel="prefetch" href="/assets/js/21.fbabcbd6.js"><link rel="prefetch" href="/assets/js/22.13927ea0.js"><link rel="prefetch" href="/assets/js/24.32925ff2.js"><link rel="prefetch" href="/assets/js/25.7aa0e1ed.js"><link rel="prefetch" href="/assets/js/26.ca27a143.js"><link rel="prefetch" href="/assets/js/27.8d248508.js"><link rel="prefetch" href="/assets/js/28.6d467f80.js"><link rel="prefetch" href="/assets/js/29.d0462958.js"><link rel="prefetch" href="/assets/js/3.425531bf.js"><link rel="prefetch" href="/assets/js/30.8b05a0c2.js"><link rel="prefetch" href="/assets/js/31.7b9ee93d.js"><link rel="prefetch" href="/assets/js/32.309cfa25.js"><link rel="prefetch" href="/assets/js/33.11c2341a.js"><link rel="prefetch" href="/assets/js/4.c0667068.js"><link rel="prefetch" href="/assets/js/5.cd04caea.js"><link rel="prefetch" href="/assets/js/6.22a02351.js"><link rel="prefetch" href="/assets/js/7.3a87c63c.js"><link rel="prefetch" href="/assets/js/8.7771a382.js"><link rel="prefetch" href="/assets/js/9.167ee458.js">
    <link rel="stylesheet" href="/assets/css/0.styles.795a5f26.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/babe.png" alt="💫Viaのblog" class="logo"> <span class="site-name can-hide">💫Viaのblog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React🌴" class="dropdown-title"><span class="title">React🌴</span> <span class="arrow down"></span></button> <button type="button" aria-label="React🌴" class="mobile-dropdown-title"><span class="title">React🌴</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/reactCode.html" class="nav-link">
  底层
</a></li><li class="dropdown-item"><!----> <a href="/pages/react.html" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic 🐳" class="dropdown-title"><span class="title">Basic 🐳</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic 🐳" class="mobile-dropdown-title"><span class="title">Basic 🐳</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/javascript.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/pages/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/webpack.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/pages/flutter.html" class="nav-link">
  Flutter
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web 🌏" class="dropdown-title"><span class="title">Web 🌏</span> <span class="arrow down"></span></button> <button type="button" aria-label="Web 🌏" class="mobile-dropdown-title"><span class="title">Web 🌏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/http.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/pages/browser.html" class="nav-link">
  浏览器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node ☁️" class="dropdown-title"><span class="title">Node ☁️</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node ☁️" class="mobile-dropdown-title"><span class="title">Node ☁️</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/pages/nest.html" class="nav-link">
  nest
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog ✍🏻" class="dropdown-title"><span class="title">Blog ✍🏻</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog ✍🏻" class="mobile-dropdown-title"><span class="title">Blog ✍🏻</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/log.html" class="nav-link">
  日常记录
</a></li><li class="dropdown-item"><!----> <a href="/pages/blog.html" class="nav-link">
  博客
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React🌴" class="dropdown-title"><span class="title">React🌴</span> <span class="arrow down"></span></button> <button type="button" aria-label="React🌴" class="mobile-dropdown-title"><span class="title">React🌴</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/reactCode.html" class="nav-link">
  底层
</a></li><li class="dropdown-item"><!----> <a href="/pages/react.html" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic 🐳" class="dropdown-title"><span class="title">Basic 🐳</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic 🐳" class="mobile-dropdown-title"><span class="title">Basic 🐳</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/javascript.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/pages/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/webpack.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/pages/flutter.html" class="nav-link">
  Flutter
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web 🌏" class="dropdown-title"><span class="title">Web 🌏</span> <span class="arrow down"></span></button> <button type="button" aria-label="Web 🌏" class="mobile-dropdown-title"><span class="title">Web 🌏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/http.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/pages/browser.html" class="nav-link">
  浏览器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node ☁️" class="dropdown-title"><span class="title">Node ☁️</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node ☁️" class="mobile-dropdown-title"><span class="title">Node ☁️</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/pages/nest.html" class="nav-link">
  nest
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog ✍🏻" class="dropdown-title"><span class="title">Blog ✍🏻</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog ✍🏻" class="mobile-dropdown-title"><span class="title">Blog ✍🏻</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/log.html" class="nav-link">
  日常记录
</a></li><li class="dropdown-item"><!----> <a href="/pages/blog.html" class="nav-link">
  博客
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/http.html#http-缓存" class="sidebar-link">HTTP 缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/http.html#强缓存" class="sidebar-link">强缓存</a></li><li class="sidebar-sub-header"><a href="/pages/http.html#协商缓存" class="sidebar-link">协商缓存</a></li></ul></li><li><a href="/pages/http.html#http-协议" class="sidebar-link">HTTP 协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/http.html#协议升级机制" class="sidebar-link">协议升级机制</a></li><li class="sidebar-sub-header"><a href="/pages/http.html#tcp-协议" class="sidebar-link">TCP 协议</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h1> <h2 id="http-缓存"><a href="#http-缓存" class="header-anchor">#</a> HTTP 缓存</h2> <h3 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> 强缓存</h3> <p>Response Header 设置 Cache-Control 和 Expires<br>
优先级：Cache-Control &gt; Expires</p> <h4 id="expires-http1-0"><a href="#expires-http1-0" class="header-anchor">#</a> Expires(HTTP1.0)：</h4> <p>缓存的到期时间，若请求时间小于该时间，则直接使用缓存结果。
使用时间比较缺点：若客户端与服务端的时间由于时区或其他原因不一致，则缓存直接失效</p> <h4 id="cache-control-http1-1-目前浏览器"><a href="#cache-control-http1-1-目前浏览器" class="header-anchor">#</a> Cache-Control(HTTP1.1,目前浏览器)：</h4> <ul><li>public：所有内容都将被缓存（客户端和代理服务器都可缓存）</li> <li>private(默认)：所有内容仅客户端可缓存</li> <li>no-cache：客户端缓存内容，通过协商缓存来决定是否缓存</li> <li>no-store：不强制缓存，也不协商缓存</li> <li>max-age=xxx ：缓存内容将在本次请求 xxx 秒后失效，xxx 秒内强制缓存生效</li></ul> <h4 id="从-network-中的-size-可查看缓存是否生效以及位置"><a href="#从-network-中的-size-可查看缓存是否生效以及位置" class="header-anchor">#</a> 从 NetWork 中的 size 可查看缓存是否生效以及位置：</h4> <p><strong>from memory cache</strong> 内存缓存<br>
特点：将编译解析后的文件（如：js 和图片）存在该进程的内存中，方便下次快速读取，进程关闭，内存清空。</p> <p><strong>from disk cache</strong> 硬盘缓存<br>
特点：需要对该缓存存放的硬盘文件进行 I/O 操作，然后重新解析内容（如：css），读取复杂，速度比内存缓存慢。</p> <blockquote><p>浏览器读取缓存的顺序：memory –&gt; disk。</p></blockquote> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <p>当强缓存失效或未设置时，进入协商缓存流程</p> <ol><li>协商缓存生效，返回 304</li> <li>协商缓存失效，返回 200 和请求结果</li></ol> <p>控制协商缓存的字段分别有：<br>
Etag / If-None-Match 和 Last-Modified / If-Modified-Since<br>
优先级：Etag / If-None-Match &gt; Last-Modified / If-Modified-Since</p> <h4 id="last-modified-if-modified-since"><a href="#last-modified-if-modified-since" class="header-anchor">#</a> Last-Modified / If-Modified-Since</h4> <p>Last-Modified: response header 设置，表示：该资源文件在服务器最后被修改的时间。<br>
If-Modified-Since：request header 设置，上次请求响应中的 Last-Modified<br>
服务端将两者对比后决定返回 200 或 304</p> <h4 id="etag-if-none-match"><a href="#etag-if-none-match" class="header-anchor">#</a> Etag / If-None-Match</h4> <p>Etag：资源文件的一个唯一标识(由服务器生成) response header 设置<br>
If-None-Match：上一个 Etag，request header 设置<br>
服务端将两者对比，一致则返回 304，不一致则返回 200，和新的资源</p> <h4 id="为什么要有-etag"><a href="#为什么要有-etag" class="header-anchor">#</a> 为什么要有 etag？</h4> <p>你可能会觉得使用 last-modified 已经足以让浏览器知道本地的缓存副本是否足够新，为什么还需要 etag 呢？HTTP1.1 中 etag 的出现（也就是说，etag 是新增的，为了解决之前只有 If-Modified 的缺点）主要是为了解决几个 last-modified 比较难解决的问题：</p> <ol><li><p>一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新 get；</p></li> <li><p>某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说 1s 内修改了 N 次)，if-modified-since 能检查到的粒度是秒级的，这种修改无法判断(或者说 UNIX 记录 MTIME 只能精确到秒)；</p></li> <li><p>某些服务器不能精确的得到文件的最后修改时间。</p></li></ol> <h2 id="http-协议"><a href="#http-协议" class="header-anchor">#</a> HTTP 协议</h2> <h3 id="协议升级机制"><a href="#协议升级机制" class="header-anchor">#</a> 协议升级机制</h3> <p>由客户端发起，将一个<strong>已建立</strong>的<strong>http1.1</strong>连接升级成新的、不相容的连接，只能由 http1.1 升级到 http2 或 ws</p> <blockquote><p>http2 不支持连接升级机制，不支持 101 状态码</p></blockquote> <h4 id="配置request-header"><a href="#配置request-header" class="header-anchor">#</a> 配置<strong>Request Header</strong>：</h4> <p>Connextion：Upgrade<br>
Upgrade: 协议/版本(如：websocket、http/2)<br>
若服务端同意升级本次连接，则返回 101，header 携带 Upgrade：协议<br>
upgrade-insecure-requests：1 表示支持升级机制</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将站点的所有url替换成https的url</span>
<span class="token comment">// 非跳转(non-navigational)的不安全资源请求会自动升级到HTTPS</span>
<span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;Content-Security-Policy&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;upgrade-insecure-requests&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><h3 id="tcp-协议"><a href="#tcp-协议" class="header-anchor">#</a> TCP 协议</h3> <p>为什么是三次握手？<br>
在谢希仁著《计算机网络》第四版中讲“三次握手”的目的是“为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误”。<br>
《计算机网络》一书中讲“三次握手”的目的是为了解决“网络中存在延迟的重复分组”的问题。<br>
通信双方需要就某个问题达成一致。而要解决这个问题, 无论你在消息中包含什么信息, 三次通信是理论上建立可靠传输的最小值。<br>
如果两次就建立，会浪费server的资源。</p> <blockquote><p>参考：<a href="https://juejin.cn/post/6844903593275817998" target="_blank" rel="noopener noreferrer">彻底理解浏览器的缓存机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
参考：<a href="https://www.jianshu.com/p/9c95db596df5" target="_blank" rel="noopener noreferrer">彻底弄懂强缓存与协商缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/30/2022, 10:39:48 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1a8c5bfd.js" defer></script><script src="/assets/js/2.dec9ee96.js" defer></script><script src="/assets/js/23.a9bc2c2a.js" defer></script>
  </body>
</html>
